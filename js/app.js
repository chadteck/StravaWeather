var constant = require('./constants.js'),
    activity = require('./activity.js'),
    effort = require('./effort.js');

module.exports = {
  /* render the logo for Wunderground */
  logo: function(selector) {
    var logo = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ8AAABfCAMAAADBLeVmAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6REMzOTNGNzlBQjIwMTFFNEE0NjNENjVBQzExNTVDNDYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6REMzOTNGN0FBQjIwMTFFNEE0NjNENjVBQzExNTVDNDYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpEQzM5M0Y3N0FCMjAxMUU0QTQ2M0Q2NUFDMTE1NUM0NiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpEQzM5M0Y3OEFCMjAxMUU0QTQ2M0Q2NUFDMTE1NUM0NiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvN71nsAAAMAUExURQea2C4wMud8Kf7+/srLy7XDAORzKNq/BKrT7bLDGfe7AK/MUP736e+1rfXIrdNDJvvo5YaHidl3Jt5mF+V4KJaXmIir2Xd4ecvc7jh9wvC0j5i1ZOzs7NpYKMzm8+BtJ++8APT09Pa2AGO246mqq8rCDv3npckWAD6d17tbJ9dNJ2ZoaTRuuumWhuHi493d3dFyJf/IANmJLymb9ZXEJfnag/Clb9Q+J9tcJ+hzADV2vvXVajmMzc4nJ9VKJ4zK6/vz191hKOFzdDuV0uFzU7e3uN5rAFVXWMLEJ8prI9e4APfb19LS0yyk9uqqFsQKAJ7JADJmteh/KZm9APrm29hRJ9E1JwCA2C9ZrgCV/Hm/AtlVJ+jz+uuEKf378vj4+OeSaurFANI7A/e5AOSCa/TNw+e9ANdOStRHJvnYwP318mqzZEZISvjEMS+j2/GWRQsND9AvJ91dAPP6/Wi3K9zs9/3EADFhsv3rvYKDhIK74+p9E4myikCp3vfNU84pAP39+vWyAGGuwue4ANM6ADyYuNM5JoSf0SGe2tpTADmCx3WwpdZGA9LOSMsbFtjHAPbekf76+c8oKenDBhdJpvC4AOnFLNhNAOezAO304+/1+v3vy8vimTuR0AA6nssgAL/HADun3UOq3tI8HCmQ0t5wKPn8/tRBGN18Jve8ATmHyuWAUj2Z1T+h2eyGKtlLANxcFTKFytlQEtRAANEzEjOW3iRPqdM+Pe2HLOmCKuKcH/OtAMdTAjuk4M8rJ02q6e29AJ+goXBxc2tsbt5mKPe/H01OUFBSU/r7+2BiY9lUItxiPfLDxeqenEBBQ1xdXs0iH3x9f9dIFyMlJjg5O4uOjubm5/739tZNKjmc2tnZ2lKqycp3JpGSkymKvZHDrzFdsMPW1cDBwenp6eCUA+FvNxgZG1Zzut1jX/zv69AuFfDuwNbW1vK+u/b660un2OqJO+Z/O/XNzSmR0mGCwhyByiSKz1Gf0NTbe9jrxvO4AODrtumBKuaKh3+5df///2jwR00AAAEAdFJOU////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wBT9wclAAANvUlEQVR42uybf1gTRxrHCRPxJwJGCtUgBuLRmkqoRoRWULSISDRWERXFaKkWPeSCnChyKaR6FtSjhfqrpUqBQ0WtWrUotXAlIASsKCZEjwPPg5rTira1d7RntXOzm2Qzu4m6UR+bP3z32QeTZXc/fN/3OzM7szrBpx8L09j/rtNvwDehj0Pz7XHyB47MN8wpZ6ED8wH/nJwJDsy30KmkOCXNcfkm5ChLnIY5LF9aSrFSmfI34Kh8w5xKlEql02oH5QMlKQivxGmCg/KtdlISUZyT5ph8E3KI9CIB+zgkX1qO0hgpJXscka+PUT4l6ybm6fLtKU4x6afM8XdAPmPjYnRIykLH4/M3lx9rhzxVvoU5xRSfskoJHI2vjyW9RB8yzNH4/FMwPGVOHwfjA1j5EQ7xf6afnZ0bXn/sDPxU+VbjfOwG0U+VD5TkUIAlc1kNsZ5u+5zmlEL1v8o9j8UHYr6+GXPxvuddjIl1X/FgsQYUFq6dODGb0ULnpJSgRrrKyZ/Krty7k7sa2Ml3+0Re3vmA1LP5No9eXxy+t3TvglGC+9JNfH9lYqIf2srHFuL3TptQkpKTUlw8zPzlR8J5Wysqtv7b2x4+MEkWcD4sLCxPFuZu47BrVlZp+IWRSW+8sfQ+dG+rVH6Jif3QlqhSnV5Ly/EwFFRuvSt2V1TMq5i3e/e7gDUfuCYLM0ZBgOy61eGbRaXh4eEjR85ZcCHLFmA2ouuHhZ9q5YD7OXr31ivziLgyb/e7rPlcZQVhZkBZHPPvcg8oTSLwCMCjWdb4ixJVieX9aKFSFdrE01QgvCskHgLksuTLP58XFmYBvM04/GZWUhKh36U5cxb4HBvFPHuAyo9B169fuZ9tQO7uNVeoqFgjZ8d3WxaG873F8EbWuCRSP4S3wKdpC0PARSq/ftZR7ndqoo07/WcrRYdAt3qz4zuL84WFyegWOVtkxLtE4C0I2TCQXror/V4mwwpwW7bVjfjzrqzBYt5z7Pgm5dH57tGSX1rq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"/ >';
    selector.innerHTML += 'Weather data brought to you by <a href="http://www.wunderground.com/?apiref="' + constant.apiref + ' target="_blank">' + logo + '</a>';
  },

  /* publish help for setting up wunderground API key */
  keys: function() {
    if (!constant.wundergroundKey) {
      console.warn('It looks as though you don\'t have a Wunderground API key set on your browser. Please navigate to http://www.wunderground.com/weather/api/ and register an account. Don\'t worry, it\'s free. Once you\'ve done this, run this command in your browser:');
      console.log("localStorage.setItem('strava-weather-wunderground-key','<your wunderground key>');");
      console.warn('Once you\'ve done this, refresh the browser.');
    }

    if (!constant.stravaKey) {
      console.warn('You need to set up your own Strava API key (sorry, not publishing mine for now...). You can get your strava API key here https://www.strava.com/settings/api Once youve got a key, set it by running');
      console.log("localStorage.setItem('strava-weather-strava-key','<your strava API key>');");
      console.warn('Once you\'ve done this, refresh the browser.');
    }


    return (!constant.wundergroundKey || !constant.stravaKey) ? false : true;
  },

  /* start the chrome extension */
  start: function () {
    var self = this;
    if (self.keys()) {
      // you're on an activities page (sloppy)
      if (window.location.href.indexOf('activities') + 1) {
        self.logo(document.querySelector('.activity-stats .inset'));
        activity.get(); return;
      }

      // you're on a segment page. (sloppy)
      if (window.location.href.indexOf('segments') + 1) {
        self.logo(document.querySelector('.ldrboard .filters'));
        effort.get(); return;
      }
    }
  }
};